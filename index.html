<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tornado Classroom Quiz Game</title>
  <style>
    :root {
      --teamA: #e74c3c;
      --teamB: #3498db;
      --btn-bg: #add8e6;
      --btn-hover: #87ceeb;
    }
    body {
      margin:0; padding:20px;
      font-family: Arial, sans-serif;
      background: #eef6fb;
      color: #333;
      text-align: center;
    }
    .hidden { display:none; }

    /* SETUP SCREEN */
    #setupScreen {
      max-width: 600px;
      margin: auto;
    }
    #setupScreen h1 { font-size:2em; margin-bottom:5px; }
    #setupScreen p { margin-bottom:20px; }
    #setupForm label { display:block; margin:10px 0; text-align:left; }
    #setupForm input, #setupForm select, #setupForm textarea {
      width:100%; padding:8px; font-size:1em; margin-top:4px;
      box-sizing:border-box;
    }
    #setupForm textarea { height:120px; resize:vertical; }
    #setupForm .radio-group { text-align:left; margin:10px 0; }
    #setupForm button {
      margin-top:20px; padding:10px 20px; font-size:1em;
      cursor:pointer;
    }

    /* GAME SCREEN */
    #gameScreen {
      max-width:900px;
      margin:auto;
    }
    #gameScreen h1 { font-size:2.5em; margin-bottom:5px; }
    #gameScreen h2 { font-size:1.2em; color:#555; margin-bottom:20px; }
    .scoreboard {
      display:flex; justify-content:center; gap:50px; margin-bottom:20px;
      position:relative;
    }
    .team {
      background:white; padding:10px 20px;
      border-radius:15px; box-shadow:0 0 10px rgba(0,0,0,0.1);
      min-width:150px;
    }
    #nameA { color:var(--teamA); }
    #nameB { color:var(--teamB); }
    .announcement { min-height:1.4em; margin-bottom:5px; font-weight:bold; }
    .team h2 { margin:5px 0 0; }
    .team p { font-size:2em; margin:5px 0 0; }
    #turnDisplay { font-size:1.2em; margin-bottom:20px; }

    /* question & pass */
    #questionContainer {
      margin-bottom:20px;
      display:flex; justify-content: center;
    }
    #question {
      font-size:1.2em; font-weight:bold;
      max-width:400px;
      padding:10px;
    }
    #passBtn {
      margin-left:20px; padding:8px 16px; font-size:1em;
      cursor:pointer;
    }

    /* grid */
    #grid {
      display:grid; gap:10px; margin-bottom:20px; padding:0 20px;
    }
    #grid button {
      font-size:1.2em; padding:20px; border:none;
      border-radius:10px; background:var(--btn-bg);
      cursor:pointer; transition:background .2s, color .2s;
      display:flex; align-items:center; justify-content:center;
    }
    #grid button:hover { background:var(--btn-hover); }
    #grid button:disabled {
      background:#ccc; cursor:not-allowed;
    }

    #resetBtn { padding:8px 16px; font-size:1em; cursor:pointer; }

    /* footer */
    .footer {
      font-size:0.8em; color:#666; margin-top:30px;
    }
  </style>
</head>
<body>

  <!-- SETUP SCREEN -->
  <div id="setupScreen">
    <h1>üå™ Tornado Game Setup</h1>
    <p>Enter team names, choose a grid size, and optionally paste your quiz questions below (one per line, prefixed by number).</p>
    <form id="setupForm" onsubmit="return false;">
      <label>
        Team A Name:
        <input type="text" id="teamANameInput" value="Team A" required>
      </label>
      <label>
        Team B Name:
        <input type="text" id="teamBNameInput" value="Team B" required>
      </label>
      <label>
        Grid Size (boxes):
        <select id="gridSizeInput">
          <option>8</option>
          <option>10</option>
          <option>16</option>
          <option selected>20</option>
          <option>24</option>
          <option>30</option>
          <option>32</option>
          <option>40</option>
        </select>
      </label>
      <label>
        Questions (optional):
        <textarea id="questionsInput" placeholder="1. What is your name?&#10;2. Where are you from?"></textarea>
      </label>
      <div class="radio-group">
        Order:
        <label><input type="radio" name="order" value="inorder" checked> In order</label>
        <label><input type="radio" name="order" value="random"> Random</label>
      </div>
      <button id="startGameBtn">Start Game</button>
    </form>
  </div>

  <!-- GAME SCREEN -->
  <div id="gameScreen" class="hidden">
    <h1>üå™ Tornado Game</h1>
    <h2>Free Online ESL Classroom Quiz</h2>

    <div class="scoreboard">
      <div class="team">
        <div id="annA" class="announcement"></div>
        <h2 id="nameA">Team A</h2>
        <p id="scoreA">0</p>
      </div>
      <div class="team">
        <div id="annB" class="announcement"></div>
        <h2 id="nameB">Team B</h2>
        <p id="scoreB">0</p>
      </div>
    </div>

    <h3 id="turnDisplay">Team A‚Äôs turn</h3>

    <div id="questionContainer">
      <div id="question"></div>
      <button id="passBtn">Pass ‚ùå</button>
    </div>

    <div id="grid"></div>
    <button id="resetBtn">üîÑ Reset Game</button>

    <div class="footer">Created by Timothy Piontek</div>
  </div>

  <script>
    // State
    let rewards = [],
        scores = {A:0, B:0},
        picks  = {A:0, B:0},
        turn    = 'A',
        names   = {A:'Team A', B:'Team B'},
        total   = 20,
        questions = [],
        qIndex    = 0;

    // DOM
    const setupScreen = document.getElementById('setupScreen'),
          gameScreen  = document.getElementById('gameScreen'),
          startBtn    = document.getElementById('startGameBtn'),
          resetBtn    = document.getElementById('resetBtn'),
          passBtn     = document.getElementById('passBtn'),
          gridEl      = document.getElementById('grid'),
          annA        = document.getElementById('annA'),
          annB        = document.getElementById('annB'),
          nameAEl     = document.getElementById('nameA'),
          nameBEl     = document.getElementById('nameB'),
          scoreAEl    = document.getElementById('scoreA'),
          scoreBEl    = document.getElementById('scoreB'),
          turnEl      = document.getElementById('turnDisplay'),
          questionEl  = document.getElementById('question');

    startBtn.onclick = () => {
      // read setup
      names.A = document.getElementById('teamANameInput').value.trim() || 'Team A';
      names.B = document.getElementById('teamBNameInput').value.trim() || 'Team B';
      total   = parseInt(document.getElementById('gridSizeInput').value,10);

      // parse questions
      const raw = document.getElementById('questionsInput').value
                      .split('\n')
                      .map(l=>l.trim())
                      .filter(l=>l.length>0)
                      .map(l=>l.replace(/^\d+\.\s*/,''));
      const order = document.querySelector('input[name="order"]:checked').value;
      questions = raw.slice();
      if(order==='random') {
        for(let i=questions.length-1;i>0;i--){
          const j = Math.floor(Math.random()*(i+1));
          [questions[i],questions[j]] = [questions[j],questions[i]];
        }
      }
      qIndex = 0;

      // hide setup, show game
      setupScreen.classList.add('hidden');
      gameScreen.classList.remove('hidden');

      initGame();
    };

    resetBtn.onclick = initGame;
    passBtn.onclick  = () => {
      // move to next team, next question
      turn = (turn==='A'?'B':'A');
      updateTurn();
      showQuestion();
    };

    function initGame(){
      // reset state
      scores = {A:0, B:0};
      picks  = {A:0, B:0};
      annA.textContent = '';
      annB.textContent = '';
      nameAEl.textContent = names.A;
      nameBEl.textContent = names.B;
      updateScores();
      turn = 'A';
      updateTurn();

      buildRewards(total);
      buildGrid(total);
      showQuestion();
    }

    function buildRewards(n){
      const ptsBase    = Math.floor(n*0.7),
            loseBase   = Math.floor(n*0.1),
            stealBase  = loseBase,
            dblBase    = n - (ptsBase + loseBase + stealBase),
            minSpec    = n>=24?3:2,
            loseCount  = Math.max(loseBase,  minSpec),
            stealCount = Math.max(stealBase, minSpec),
            dblCount   = Math.max(dblBase,   minSpec),
            ptsCount   = n - (loseCount + stealCount + dblCount);

      rewards = [];
      for(let i=0;i<ptsCount;i++)  rewards.push({type:'points',value:(Math.floor(Math.random()*10)+1)*100});
      for(let i=0;i<loseCount;i++)   rewards.push({type:'lose'});
      for(let i=0;i<stealCount;i++)  rewards.push({type:'steal'});
      for(let i=0;i<dblCount;i++)    rewards.push({type:'double'});

      for(let i=rewards.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [rewards[i], rewards[j]] = [rewards[j], rewards[i]];
      }
    }

    function buildGrid(n){
      gridEl.innerHTML = '';
      let cols = Math.floor(Math.sqrt(n));
      if(cols<2) cols=2;
      gridEl.style.gridTemplateColumns = `repeat(${cols},1fr)`;
      for(let i=0;i<n;i++){
        const btn = document.createElement('button');
        btn.textContent = i+1;
        btn.onclick = ()=>handlePick(btn,i);
        gridEl.appendChild(btn);
      }
    }

    function handlePick(btn,i){
      let r = rewards[i],
          me = turn;

      // enforce first pick must be points
      if(picks[me]===0 && r.type!=='points'){
        r = {type:'points',value:(Math.floor(Math.random()*10)+1)*100};
      }
      picks[me]++;

      let out='';
      if(r.type==='points'){
        scores[me]+=r.value;
        out = '+'+r.value;
        btn.style.color = me==='A'?'var(--teamA)':'var(--teamB)';
      }
      else if(r.type==='lose'){
        scores[me]=0;
        out='‚òπÔ∏è';
        styleSpecial(btn, me);
        playSad();
      }
      else if(r.type==='steal'){
        const other = me==='A'?'B':'A';
        scores[me]+=scores[other];
        scores[other]=0;
        out='üå™';
        styleSpecial(btn, me);
        playWind();
      }
      else {
        scores[me]*=2;
        out='x2';
        styleSpecial(btn, me);
      }

      // announce
      if(me==='A'){
        annA.textContent = `${names.A} got ${out}`;
        annB.textContent = '';
      } else {
        annB.textContent = `${names.B} got ${out}`;
        annA.textContent = '';
      }

      btn.textContent = out;
      btn.disabled = true;
      updateScores();

      const done = document.querySelectorAll('#grid button:disabled').length;
      if(done === total){
        // highest score wins
        if(scores.A > scores.B){
          annA.textContent = `${names.A} wins! üèÜ`;
          annB.textContent = '';
        } else if(scores.B > scores.A){
          annB.textContent = `${names.B} wins! üèÜ`;
          annA.textContent = '';
        } else {
          annA.textContent = `It's a tie!`;
          annB.textContent = '';
        }
      } else {
        // move on
        turn = me==='A'?'B':'A';
        updateTurn();
        showQuestion();
      }
    }

    function showQuestion(){
      if(questions.length===0){
        questionEl.textContent = '';
        return;
      }
      // display and cycle
      questionEl.textContent = questions[qIndex];
      questionEl.style.color = (turn==='A'?'var(--teamA)':'var(--teamB)');
      questionEl.style.textAlign = (turn==='A'?'left':'right');
      qIndex = (qIndex+1)%questions.length;
    }

    function styleSpecial(btn, team){
      const clr = team==='A'? 'var(--teamA)' : 'var(--teamB)';
      btn.style.background = clr;
      btn.style.color      = '#fff';
      btn.style.fontSize   = '2.5em';
    }

    function updateScores(){
      scoreAEl.textContent = scores.A;
      scoreBEl.textContent = scores.B;
    }
    function updateTurn(){
      turnEl.textContent = `${names[turn]}'s turn`;
    }

    // sounds
    function playWind(){
      const C=new (window.AudioContext||window.webkitAudioContext)(),
            buf=C.createBuffer(1,C.sampleRate*0.5,C.sampleRate),
            d=buf.getChannelData(0);
      for(let i=0;i<d.length;i++) d[i]=Math.random()*2-1;
      const src=C.createBufferSource(), f=C.createBiquadFilter();
      src.buffer=buf; f.type='lowpass'; f.frequency.value=800;
      src.connect(f).connect(C.destination); src.start();
      setTimeout(()=>src.stop(),500);
    }
    function playSad(){
      const C=new (window.AudioContext||window.webkitAudioContext)(),
            o=C.createOscillator(), g=C.createGain();
      o.type='triangle'; o.frequency.value=220;
      o.connect(g).connect(C.destination);
      o.start(); g.gain.setValueAtTime(1,C.currentTime);
      g.gain.exponentialRampToValueAtTime(0.001,C.currentTime+0.8);
      setTimeout(()=>o.stop(),800);
    }

    // init
    // no auto-init: waits for user to hit "Start Game"
  </script>
</body>
</html>
