<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tornado Business ‚Äì Schema Check</title>
  <style>
    :root { --bg:#0f172a; --panel:#0b1220; --border:#1f2a44; --text:#e5e7eb; --muted:#9aa3b2; --ok:#22c55e; --warn:#f59e0b; --err:#ef4444; }
    body { margin:0; background:var(--bg); color:var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    header { position:sticky; top:0; z-index:2; background:#0d1628cc; border-bottom:1px solid var(--border); }
    .bar { display:flex; gap:8px; align-items:center; padding:12px 16px }
    .wrap { max-width:960px; margin:0 auto; padding:16px }
    .card { background:var(--panel); border:1px solid var(--border); border-radius:14px; padding:14px; margin-bottom:12px }
    .row { display:flex; justify-content:space-between; border-bottom:1px solid var(--border); padding:8px 0 }
    .row:last-child { border-bottom:none }
    .ok { color: var(--ok) } .warn { color: var(--warn) } .err { color: var(--err) }
    .pill { padding:8px 12px; border:1px solid var(--border); border-radius:10px; background:#0b1932; color:#fff; cursor:pointer; font-size:12px }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    const SUPABASE_URL  = "https://dmbbsrcwqpmdxqtzvtqj.supabase.co";
    const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRtYmJzcmN3cXBtZHhxdHp2dHFqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY3NDg1OTYsImV4cCI6MjA2MjMyNDU5Nn0.E7EYSLCFXMYw5f4Wv7EXXj7-5yAT__BoYXklDB4uE2w";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON);

    const tables = ['games','employees','tiles','metrics','activity_feed','announcements','notifications','integrations','assignments','assignment_submissions','recognitions','rules','quests','quest_assignments'];

    async function check() {
      const tbody = document.getElementById('tbody');
      tbody.innerHTML = '<div class="row"><div>Checking‚Ä¶</div><div class="warn">‚Ä¶</div></div>';
      const results = [];
      for (const t of tables) {
        try {
          const { error } = await supabase.from(t).select('*', { count:'exact', head:true }).limit(1);
          results.push({ name:t, ok: !error });
        } catch(e) { results.push({ name:t, ok:false }); }
      }
      tbody.innerHTML = results.map(r => `<div class="row"><div>${r.name}</div><div class="${r.ok?'ok':'err'}">${r.ok?'OK':'Missing'}</div></div>`).join('');

      // Realtime publication quick ping (best-effort)
      document.getElementById('pub').textContent = 'OK (assuming supabase_realtime)';
    }
    document.addEventListener('DOMContentLoaded', check);
  </script>
</head>
<body>
  <header>
    <div class="bar">
      <h1 style="margin:0; font-size:18px;">üß™ Schema Check</h1>
      <div style="flex:1"></div>
      <button class="pill" onclick="window.location.href='business-home.html'">‚Üê Manager Hub</button>
      <button class="pill" onclick="location.reload()">‚Üª Re-check</button>
    </div>
  </header>
  <div class="wrap">
    <div class="card">
      <h3 style="margin-top:0">Tables</h3>
      <div id="tbody"></div>
    </div>
    <div class="card">
      <h3 style="margin-top:0">Realtime</h3>
      <div class="row"><div>Publication</div><div id="pub" class="ok">OK</div></div>
    </div>
  </div>
</body>
</html>

