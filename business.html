<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tornado Business ‚Äì Manager Dashboard</title>
  <style>
    :root { --bg:#0f172a; --panel:#0b1220; --border:#1f2a44; --text:#e5e7eb; --muted:#9aa3b2; --accent:#22d3ee; }
    * { box-sizing: border-box }
    html, body { height:100%; margin:0; padding:0; font-family:system-ui, -apple-system, sans-serif; background:var(--bg); color:var(--text); }
    .container { display:grid; grid-template-columns: 300px 1fr 300px; height:100vh; gap:1px; background:var(--border); }
    .panel { background:var(--panel); padding:16px; overflow-y:auto; }
    .title { font-size:14px; font-weight:600; margin-bottom:12px; color:var(--accent); }
    .pill { padding:6px 12px; border:none; border-radius:20px; cursor:pointer; font-size:12px; font-weight:500; }
    .employee-card { background:var(--bg); border:1px solid var(--border); border-radius:8px; padding:8px; margin-bottom:8px; cursor:pointer; transition:all 0.2s; }
    .employee-card:hover { border-color:var(--accent); }
    .employee-card.selected { border-color:var(--accent); background:rgba(34,211,238,0.1); }
    .grid { display:grid; gap:2px; background:var(--border); padding:8px; border-radius:8px; max-height:70vh; overflow:auto; }
    .tile { aspect-ratio:1; background:var(--panel); border:1px solid var(--border); border-radius:4px; display:flex; align-items:center; justify-content:center; cursor:pointer; transition:all 0.2s; font-size:10px; position:relative; }
    .tile:hover { border-color:var(--accent); }
    .tile.owned { background:var(--accent); color:var(--bg); }
    .tile.headquarters { background:#f59e0b; color:var(--bg); }
    .tile.headquarters::after { content:"üè¢"; position:absolute; font-size:16px; }
    .business-tab { padding:8px 12px; border:none; background:transparent; color:var(--muted); cursor:pointer; border-bottom:2px solid transparent; }
    .business-tab.active { color:var(--accent); border-bottom-color:var(--accent); }
    .business-tab-panel { display:none; }
    .business-tab-panel.active { display:block; }
    .modal { position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.8); display:flex; align-items:center; justify-content:center; z-index:1000; }
    .card { background:var(--panel); border:1px solid var(--border); border-radius:12px; padding:20px; max-width:500px; width:90%; }
    .closeX { position:absolute; top:10px; right:15px; font-size:24px; cursor:pointer; color:var(--muted); }
    .grid2 { display:grid; grid-template-columns:1fr 1fr; gap:8px; }
  </style>
</head>
<body>
  <div class="container">
    <!-- Left Panel -->
    <div class="panel">
      <div class="title">EMPLOYEES</div>
      <div style="margin-bottom:12px;">
        <label for="rosterSelect" style="display:block; margin-bottom:4px; font-size:12px; color:var(--muted);">Select Roster:</label>
        <select id="rosterSelect" name="rosterSelect" onchange="loadSelectedRoster()" style="width:100%; padding:8px; border:1px solid var(--border); border-radius:6px; background:var(--panel); color:var(--text); margin-bottom:8px;">
          <option value="">Choose a roster...</option>
        </select>
        <label for="rosterPaste" style="display:block; margin-bottom:4px; font-size:12px; color:var(--muted);">Or paste new names:</label>
        <textarea id="rosterPaste" name="rosterPaste" placeholder="Paste employee names (one per line)" style="width:100%; padding:8px; border:1px solid var(--border); border-radius:6px; background:var(--panel); color:var(--text); min-height:60px"></textarea>
        <button class="pill" onclick="createRosterFromPaste()" style="background:#22c55e;color:#fff">Create/Update Roster</button>
      </div>
      
      <div style="margin-bottom:12px;">
        <label for="managerCode" style="display: block; font-size: 11px; color: var(--muted); margin-bottom: 4px;">Manager Code:</label>
        <input type="text" id="managerCode" name="managerCode" placeholder="DEMO" style="width: 100%; padding: 6px; border: 1px solid var(--border); border-radius: 4px; background: var(--panel); color: var(--text); font-size: 11px;">
      </div>
      
      <div id="employeeList"></div>
      
      <div class="title" style="margin-top:20px;">QUICK ACTIONS</div>
      <div style="display:flex; flex-direction:column; gap:8px;">
        <button class="pill" onclick="quickAward(1)" style="background:#22c55e;color:#fff">+1 Point</button>
        <button class="pill" onclick="quickAward(5)" style="background:#22c55e;color:#fff">+5 Points</button>
        <button class="pill" onclick="quickAward(10)" style="background:#22c55e;color:#fff">+10 Points</button>
      </div>
    </div>

    <!-- Center Panel -->
    <div class="panel">
      <div style="display:flex; align-items:center; gap:12px; margin-bottom:16px; padding:12px; background:var(--bg); border-radius:8px;">
        <span style="font-size:20px;">üè¢</span>
        <span style="font-weight:600;">Business Competition</span>
      </div>
      
      <div id="gameBoard" class="grid" style="grid-template-columns: repeat(8, 1fr);"></div>
      
      <div style="text-align:center; margin-top:16px; color:var(--muted); font-size:12px;">
        Tip: click an employee name, then click a tile.
      </div>
    </div>

    <!-- Right Panel -->
    <div class="panel">
      <div class="title">BUSINESS TOOLS</div>
      <div style="display:flex; gap:4px; margin-bottom:16px;">
        <button class="business-tab active" onclick="showTab('leaderboard')">Leaderboard</button>
        <button class="business-tab" onclick="showTab('metrics')">Metrics</button>
        <button class="business-tab" onclick="showTab('announcements')">Announcements</button>
        <button class="business-tab" onclick="showTab('rewards')">Rewards</button>
      </div>

      <!-- Leaderboard Tab -->
      <div id="tab-leaderboard" class="business-tab-panel active">
        <div class="title">TEAM RANKINGS</div>
        <div id="teamRankings" style="font-size:12px;color:var(--muted)">Team rankings will appear here...</div>
        
        <div class="title" style="margin-top:20px;">RECENT ACTIVITY</div>
        <div id="recentActivity" style="font-size:12px;color:var(--muted)">No activity yet</div>
      </div>

      <!-- Metrics Tab -->
      <div id="tab-metrics" class="business-tab-panel">
        <div class="title">TEAM METRICS</div>
        <div id="metricsDisplay" style="font-size:12px;color:var(--muted)">Metrics will appear here...</div>
        <button class="pill" onclick="showEditMetricsModal()" style="background:#f59e0b;color:#fff; margin-top:12px;">Edit Metrics</button>
      </div>

      <!-- Announcements Tab -->
      <div id="tab-announcements" class="business-tab-panel">
        <div class="title">ANNOUNCEMENTS</div>
        <div id="announcementsList" style="font-size:12px;color:var(--muted)">No announcements yet</div>
        <button class="pill" onclick="showAnnouncementModal()" style="background:#8b5cf6;color:#fff; margin-top:12px;">New Announcement</button>
      </div>

      <!-- Rewards Tab -->
      <div id="tab-rewards" class="business-tab-panel">
        <div class="title">Rewards & Incentives</div>
        <div style="margin-bottom: 8px;">
          <label for="rewardTeam" style="display: block; font-size: 11px; color: var(--muted); margin-bottom: 4px;">Winning Team Gets:</label>
          <input type="text" id="rewardTeam" name="rewardTeam" placeholder="e.g., Team dinner" style="width: 100%; padding: 6px; border: 1px solid var(--border); border-radius: 4px; background: var(--panel); color: var(--text); font-size: 11px;">
        </div>
        <div style="margin-bottom: 8px;">
          <label for="rewardPlayer" style="display: block; font-size: 11px; color: var(--muted); margin-bottom: 4px;">Top Player Gets:</label>
          <input type="text" id="rewardPlayer" name="rewardPlayer" placeholder="e.g., 1 PTO day" style="width: 100%; padding: 6px; border: 1px solid var(--border); border-radius: 4px; background: var(--panel); color: var(--text); font-size: 11px;">
        </div>
        <div style="margin-top: 8px;">
          <button id="saveRewardsBtn" onclick="saveRewards()" style="width: 100%; padding: 6px; background: #f59e0b; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px;">Save Rewards</button>
        </div>
      </div>
    </div>
  </div>

  <script>
  // Business game state
  let businessState = {
    employees: [],
    selectedEmployee: null,
    board: { w: 8, h: 8, tiles: [] },
    currentGame: null,
    teamMetrics: {
      sales: { current: 45000, target: 100000 },
      products: { current: 12, target: 25 },
      satisfaction: { current: 4.2, target: 5.0 },
      features: { current: 8, target: 15 },
      bugs: { current: 3, target: 0 }
    }
  };

  // Initialize the game
  function init() {
    loadGameData();
    loadRosterSelector();
    initializeGameBoard();
    updateDisplay();
  }

  // Load game data from localStorage
  function loadGameData() {
    const savedRosters = localStorage.getItem('businessRosters');
    if (savedRosters) {
      const rosters = JSON.parse(savedRosters);
      if (rosters.length > 0) {
        businessState.employees = rosters[0].roster || [];
        businessState.currentGame = { name: rosters[0].name, managerCode: 'DEMO' };
      }
    }
    
    // Create demo roster if none exists
    if (businessState.employees.length === 0) {
      businessState.employees = [
        { id: '1', name: 'Alice Johnson', team: 'Alpha Team', points: 150, credits: 25, balance: 150 },
        { id: '2', name: 'Bob Smith', team: 'Beta Team', points: 140, credits: 22, balance: 140 },
        { id: '3', name: 'Carol Davis', team: 'Alpha Team', points: 135, credits: 20, balance: 135 },
        { id: '4', name: 'David Wilson', team: 'Gamma Team', points: 130, credits: 18, balance: 130 }
      ];
      
      // Save demo roster
      const demoRoster = {
        id: 'demo',
        name: 'Demo Business Roster',
        roster: businessState.employees
      };
      localStorage.setItem('businessRosters', JSON.stringify([demoRoster]));
    }
    
    document.getElementById('managerCode').value = businessState.currentGame?.managerCode || 'DEMO';
  }

  // Load roster selector dropdown
  function loadRosterSelector() {
    const selector = document.getElementById('rosterSelect');
    const savedRosters = localStorage.getItem('businessRosters');
    
    selector.innerHTML = '<option value="">Choose a roster...</option>';
    
    if (savedRosters) {
      const rosters = JSON.parse(savedRosters);
      rosters.forEach(roster => {
        const option = document.createElement('option');
        option.value = roster.id;
        option.textContent = roster.name;
        selector.appendChild(option);
      });
    }
  }

  // Load selected roster
  function loadSelectedRoster() {
    const selector = document.getElementById('rosterSelect');
    const selectedId = selector.value;
    
    if (!selectedId) return;
    
    const savedRosters = localStorage.getItem('businessRosters');
    if (savedRosters) {
      const rosters = JSON.parse(savedRosters);
      const selectedRoster = rosters.find(r => r.id === selectedId);
      
      if (selectedRoster) {
        businessState.employees = selectedRoster.roster || [];
        businessState.currentGame = { name: selectedRoster.name, managerCode: 'DEMO' };
        
        // Reinitialize board with new employees
        initializeGameBoard();
        updateDisplay();
      }
    }
  }

  // Initialize the game board
  function initializeGameBoard() {
    const board = businessState.board;
    board.tiles = [];
    
    for (let y = 0; y < board.h; y++) {
      for (let x = 0; x < board.w; x++) {
        board.tiles.push({
          id: `${x}-${y}`,
          x, y,
          owner: null,
          cost: Math.floor(Math.random() * 50) + 25,
          isHeadquarters: false
        });
      }
    }
    
    // Assign starting headquarters
    assignStartingHeadquarters();
    updateGridDisplay();
  }

  // Assign starting headquarters to employees
  function assignStartingHeadquarters() {
    const employees = businessState.employees;
    const board = businessState.board;
    
    // Clear existing headquarters
    board.tiles.forEach(tile => tile.isHeadquarters = false);
    
    if (employees.length === 0) return;
    
    // For 4 or fewer employees, place in corners
    if (employees.length <= 4) {
      const corners = [
        { x: 0, y: 0 },
        { x: board.w - 1, y: 0 },
        { x: 0, y: board.h - 1 },
        { x: board.w - 1, y: board.h - 1 }
      ];
      
      employees.forEach((emp, i) => {
        if (corners[i]) {
          const tile = board.tiles.find(t => t.x === corners[i].x && t.y === corners[i].y);
          if (tile) {
            tile.owner = emp.id;
            tile.isHeadquarters = true;
            tile.cost = 0;
          }
        }
      });
    } else {
      // For more employees, place evenly around edges
      const edgePositions = [];
      const w = board.w, h = board.h;
      
      // Top and bottom edges
      for (let x = 1; x < w - 1; x++) {
        edgePositions.push({ x, y: 0 });
        edgePositions.push({ x, y: h - 1 });
      }
      // Left and right edges
      for (let y = 1; y < h - 1; y++) {
        edgePositions.push({ x: 0, y });
        edgePositions.push({ x: w - 1, y });
      }
      
      employees.forEach((emp, i) => {
        const pos = edgePositions[i % edgePositions.length];
        const tile = board.tiles.find(t => t.x === pos.x && t.y === pos.y);
        if (tile) {
          tile.owner = emp.id;
          tile.isHeadquarters = true;
          tile.cost = 0;
        }
      });
    }
  }

  // Update the grid display
  function updateGridDisplay() {
    const board = businessState.board;
    const grid = document.getElementById('gameBoard');
    
    // Set grid size
    grid.style.gridTemplateColumns = `repeat(${board.w}, 1fr)`;
    
    grid.innerHTML = '';
    board.tiles.forEach(tile => {
      const div = document.createElement('div');
      div.className = 'tile';
      div.onclick = () => selectTile(tile);
      
      if (tile.owner) {
        div.classList.add('owned');
        const owner = businessState.employees.find(e => e.id === tile.owner);
        if (owner) {
          div.textContent = owner.name.split(' ')[0];
        }
      }
      
      if (tile.isHeadquarters) {
        div.classList.add('headquarters');
        const owner = businessState.employees.find(e => e.id === tile.owner);
        if (owner) {
          div.textContent = owner.name.split(' ')[0];
        }
      }
      
      if (!tile.owner) {
        div.textContent = `$${tile.cost}`;
      }
      
      grid.appendChild(div);
    });
  }

  // Select a tile
  function selectTile(tile) {
    if (!businessState.selectedEmployee) {
      alert('Please select an employee first');
      return;
    }
    
    if (tile.owner === businessState.selectedEmployee.id) {
      alert('You already own this tile');
      return;
    }
    
    if (tile.owner && tile.owner !== businessState.selectedEmployee.id) {
      // Attack mode
      if (confirm(`Attack ${tile.owner}'s tile for $${tile.cost * 2}?`)) {
        if (businessState.selectedEmployee.balance >= tile.cost * 2) {
          businessState.selectedEmployee.balance -= tile.cost * 2;
          tile.owner = businessState.selectedEmployee.id;
          updateDisplay();
          alert('Attack successful!');
        } else {
          alert('Not enough points for attack');
        }
      }
    } else {
      // Claim mode
      if (businessState.selectedEmployee.balance >= tile.cost) {
        businessState.selectedEmployee.balance -= tile.cost;
        tile.owner = businessState.selectedEmployee.id;
        updateDisplay();
      } else {
        alert('Not enough points to claim this tile');
      }
    }
  }

  // Update all displays
  function updateDisplay() {
    updateEmployeeList();
    updateTeamRankings();
    updateMetricsDisplay();
  }

  // Update employee list
  function updateEmployeeList() {
    const list = document.getElementById('employeeList');
    list.innerHTML = '';
    
    businessState.employees.forEach(emp => {
      const div = document.createElement('div');
      div.className = 'employee-card';
      div.onclick = () => selectEmployee(emp);
      
      if (businessState.selectedEmployee?.id === emp.id) {
        div.classList.add('selected');
      }
      
      div.innerHTML = `
        <div style="font-weight:600; margin-bottom:4px;">${emp.name}</div>
        <div style="font-size:11px; color:var(--muted);">${emp.team} ‚Ä¢ ${emp.balance} pts ‚Ä¢ ${emp.credits} credits</div>
      `;
      
      list.appendChild(div);
    });
  }

  // Select an employee
  function selectEmployee(employee) {
    businessState.selectedEmployee = employee;
    updateEmployeeList();
  }

  // Quick award points
  function quickAward(points) {
    if (!businessState.selectedEmployee) {
      alert('Please select an employee first');
      return;
    }
    
    businessState.selectedEmployee.balance += points;
    businessState.selectedEmployee.points += points;
    updateDisplay();
  }

  // Create roster from pasted text
  function createRosterFromPaste() {
    const text = document.getElementById('rosterPaste').value;
    if (!text.trim()) {
      alert('Please paste employee names');
      return;
    }
    
    const names = text.split('\n').filter(name => name.trim());
    businessState.employees = names.map((name, i) => ({
      id: `emp_${i + 1}`,
      name: name.trim(),
      team: `Team ${String.fromCharCode(65 + (i % 3))}`,
      points: 100,
      credits: 0,
      balance: 100
    }));
    
    // Save to localStorage
    const roster = {
      id: 'current',
      name: 'Current Business Roster',
      roster: businessState.employees
    };
    localStorage.setItem('businessRosters', JSON.stringify([roster]));
    
    // Refresh roster selector
    loadRosterSelector();
    
    // Reinitialize board with new employees
    initializeGameBoard();
    updateDisplay();
    
    alert(`Created roster with ${businessState.employees.length} employees`);
  }

  // Show tab
  function showTab(tabName) {
    // Hide all tabs
    document.querySelectorAll('.business-tab-panel').forEach(panel => {
      panel.classList.remove('active');
    });
    document.querySelectorAll('.business-tab').forEach(tab => {
      tab.classList.remove('active');
    });
    
    // Show selected tab
    document.getElementById(`tab-${tabName}`).classList.add('active');
    event.target.classList.add('active');
  }

  // Update team rankings
  function updateTeamRankings() {
    const teams = {};
    businessState.employees.forEach(emp => {
      if (!teams[emp.team]) {
        teams[emp.team] = { name: emp.team, totalPoints: 0, members: 0 };
      }
      teams[emp.team].totalPoints += emp.balance;
      teams[emp.team].members++;
    });
    
    const rankings = Object.values(teams).sort((a, b) => b.totalPoints - a.totalPoints);
    const display = document.getElementById('teamRankings');
    
    if (rankings.length === 0) {
      display.textContent = 'No teams yet';
      return;
    }
    
    display.innerHTML = rankings.map((team, i) => `
      <div style="margin-bottom:8px; padding:8px; background:var(--bg); border-radius:6px;">
        <div style="font-weight:600;">#${i + 1} ${team.name}</div>
        <div style="font-size:11px; color:var(--muted);">${team.totalPoints} points ‚Ä¢ ${team.members} members</div>
      </div>
    `).join('');
  }

  // Update metrics display
  function updateMetricsDisplay() {
    const metrics = businessState.teamMetrics;
    const display = document.getElementById('metricsDisplay');
    
    const salesPercent = (metrics.sales.current / metrics.sales.target * 100).toFixed(1);
    
    display.innerHTML = `
      <div style="margin-bottom:12px;">
        <div style="font-weight:600; margin-bottom:4px;">üéØ Sales Goal</div>
        <div style="background:var(--bg); height:8px; border-radius:4px; overflow:hidden;">
          <div style="background:#22c55e; height:100%; width:${salesPercent}%; transition:width 0.3s;"></div>
        </div>
        <div style="font-size:11px; color:var(--muted); margin-top:4px;">$${metrics.sales.current.toLocaleString()} / $${metrics.sales.target.toLocaleString()} (${salesPercent}%)</div>
      </div>
      
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px; font-size:11px;">
        <div style="background:var(--bg); padding:8px; border-radius:6px;">
          <div style="font-weight:600;">üì¶ Products</div>
          <div style="color:var(--muted);">${metrics.products.current}/${metrics.products.target}</div>
        </div>
        <div style="background:var(--bg); padding:8px; border-radius:6px;">
          <div style="font-weight:600;">üòä Satisfaction</div>
          <div style="color:var(--muted);">${metrics.satisfaction.current}/${metrics.satisfaction.target}</div>
        </div>
        <div style="background:var(--bg); padding:8px; border-radius:6px;">
          <div style="font-weight:600;">üöÄ Features</div>
          <div style="color:var(--muted);">${metrics.features.current}/${metrics.features.target}</div>
        </div>
        <div style="background:var(--bg); padding:8px; border-radius:6px;">
          <div style="font-weight:600;">üêõ Bugs</div>
          <div style="color:var(--muted);">${metrics.bugs.current}/${metrics.bugs.target}</div>
        </div>
      </div>
    `;
  }

  // Show edit metrics modal
  function showEditMetricsModal() {
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.innerHTML = `
      <div class="card" style="width: 500px;">
        <div class="closeX" onclick="this.closest('.modal').remove()">√ó</div>
        <h2>‚öôÔ∏è Edit Team Metrics</h2>
        
        <div style="margin-bottom: 16px;">
          <label style="display: block; margin-bottom: 4px; font-weight: 600;">üéØ Main Goal (Sales)</label>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
            <input type="number" id="salesCurrent" name="salesCurrent" placeholder="Current ($)" value="${businessState.teamMetrics.sales.current}">
            <input type="number" id="salesTarget" name="salesTarget" placeholder="Target ($)" value="${businessState.teamMetrics.sales.target}">
          </div>
        </div>
        
        <div style="margin-bottom: 16px;">
          <label style="display: block; margin-bottom: 4px; font-weight: 600;">üì¶ Products Sold</label>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
            <input type="number" id="productsCurrent" name="productsCurrent" placeholder="Current" value="${businessState.teamMetrics.products.current}">
            <input type="number" id="productsTarget" name="productsTarget" placeholder="Target" value="${businessState.teamMetrics.products.target}">
          </div>
        </div>
        
        <div style="margin-bottom: 16px;">
          <label style="display: block; margin-bottom: 4px; font-weight: 600;">üòä Customer Satisfaction</label>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
            <input type="number" step="0.1" id="satisfactionCurrent" name="satisfactionCurrent" placeholder="Current" value="${businessState.teamMetrics.satisfaction.current}">
            <input type="number" step="0.1" id="satisfactionTarget" name="satisfactionTarget" placeholder="Target" value="${businessState.teamMetrics.satisfaction.target}">
          </div>
        </div>
        
        <div style="margin-bottom: 16px;">
          <label style="display: block; margin-bottom: 4px; font-weight: 600;">üöÄ Features Shipped</label>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
            <input type="number" id="featuresCurrent" name="featuresCurrent" placeholder="Current" value="${businessState.teamMetrics.features.current}">
            <input type="number" id="featuresTarget" name="featuresTarget" placeholder="Target" value="${businessState.teamMetrics.features.target}">
          </div>
        </div>
        
        <div style="margin-bottom: 16px;">
          <label style="display: block; margin-bottom: 4px; font-weight: 600;">üêõ Bugs Resolved</label>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
            <input type="number" id="bugsCurrent" name="bugsCurrent" placeholder="Current" value="${businessState.teamMetrics.bugs.current}">
            <input type="number" id="bugsTarget" name="bugsTarget" placeholder="Target" value="${businessState.teamMetrics.bugs.target}">
          </div>
        </div>
        
        <div style="display: flex; gap: 8px; margin-top: 16px;">
          <button onclick="saveMetricChanges()" style="flex: 1; padding: 10px; background: #10b981; color: white; border: none; border-radius: 6px; cursor: pointer;">üíæ Save Changes</button>
          <button onclick="this.closest('.modal').remove()" style="flex: 1; padding: 10px; background: #6b7280; color: white; border: none; border-radius: 6px; cursor: pointer;">‚ùå Cancel</button>
        </div>
      </div>
    `;
    document.body.appendChild(modal);
  }

  // Save metric changes
  function saveMetricChanges() {
    businessState.teamMetrics.sales.current = parseInt(document.getElementById('salesCurrent').value) || 0;
    businessState.teamMetrics.sales.target = parseInt(document.getElementById('salesTarget').value) || 0;
    businessState.teamMetrics.products.current = parseInt(document.getElementById('productsCurrent').value) || 0;
    businessState.teamMetrics.products.target = parseInt(document.getElementById('productsTarget').value) || 0;
    businessState.teamMetrics.satisfaction.current = parseFloat(document.getElementById('satisfactionCurrent').value) || 0;
    businessState.teamMetrics.satisfaction.target = parseFloat(document.getElementById('satisfactionTarget').value) || 0;
    businessState.teamMetrics.features.current = parseInt(document.getElementById('featuresCurrent').value) || 0;
    businessState.teamMetrics.features.target = parseInt(document.getElementById('featuresTarget').value) || 0;
    businessState.teamMetrics.bugs.current = parseInt(document.getElementById('bugsCurrent').value) || 0;
    businessState.teamMetrics.bugs.target = parseInt(document.getElementById('bugsTarget').value) || 0;
    
    updateMetricsDisplay();
    document.querySelector('.modal').remove();
    alert('‚úÖ Metrics updated!');
  }

  // Show announcement modal
  function showAnnouncementModal() {
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.innerHTML = `
      <div class="card" style="width: 560px;">
        <div class="closeX" onclick="this.closest('.modal').remove()">√ó</div>
        <h2>üì£ New Announcement</h2>
        <div style="display:grid; gap:8px;">
          <label for="annTitle" style="display:block; margin-bottom:4px; font-size:12px; color:var(--muted);">Title:</label>
          <input id="annTitle" name="annTitle" placeholder="Title" />
          <label for="annBody" style="display:block; margin-bottom:4px; font-size:12px; color:var(--muted);">Message:</label>
          <textarea id="annBody" name="annBody" placeholder="Write your announcement..." style="min-height:120px"></textarea>
          <div style="display:flex; gap:8px;">
            <button onclick="saveAnnouncement()" style="flex:1; padding:10px; background:#8b5cf6; color:#fff; border:none; border-radius:8px; cursor:pointer;">Post</button>
            <button onclick="this.closest('.modal').remove()" style="flex:1; padding:10px; background:#6b7280; color:#fff; border:none; border-radius:8px; cursor:pointer;">Cancel</button>
          </div>
        </div>
      </div>
    `;
    document.body.appendChild(modal);
  }

  // Save announcement
  function saveAnnouncement() {
    const title = document.getElementById('annTitle').value;
    const body = document.getElementById('annBody').value;
    
    if (!title || !body) {
      alert('Please fill in both title and message');
      return;
    }
    
    // Add to announcements list
    const announcements = JSON.parse(localStorage.getItem('businessAnnouncements') || '[]');
    announcements.push({
      id: Date.now(),
      title,
      body,
      date: new Date().toISOString()
    });
    localStorage.setItem('businessAnnouncements', JSON.stringify(announcements));
    
    updateAnnouncementsList();
    document.querySelector('.modal').remove();
    alert('‚úÖ Announcement posted!');
  }

  // Update announcements list
  function updateAnnouncementsList() {
    const announcements = JSON.parse(localStorage.getItem('businessAnnouncements') || '[]');
    const display = document.getElementById('announcementsList');
    
    if (announcements.length === 0) {
      display.textContent = 'No announcements yet';
      return;
    }
    
    display.innerHTML = announcements.slice(-5).reverse().map(ann => `
      <div style="margin-bottom:12px; padding:8px; background:var(--bg); border-radius:6px;">
        <div style="font-weight:600; margin-bottom:4px;">${ann.title}</div>
        <div style="font-size:11px; color:var(--muted); margin-bottom:4px;">${new Date(ann.date).toLocaleString()}</div>
        <div style="font-size:12px;">${ann.body}</div>
      </div>
    `).join('');
  }

  // Save rewards
  function saveRewards() {
    const teamReward = document.getElementById('rewardTeam').value;
    const playerReward = document.getElementById('rewardPlayer').value;
    
    localStorage.setItem('businessRewards', JSON.stringify({
      team: teamReward,
      player: playerReward,
      updated: new Date().toISOString()
    }));
    
    alert('‚úÖ Rewards saved!');
  }

  // Initialize when page loads
  document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
